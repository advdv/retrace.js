!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){var b=a("./src/retrace.js");window.Retrace=b},{"./src/retrace.js":3}],2:[function(a,b,c){var d="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};!function(a){"use strict";function e(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}function f(a,b){Object.defineProperty(this,"kind",{value:a,enumerable:!0}),b&&b.length&&Object.defineProperty(this,"path",{value:b,enumerable:!0})}function g(a,b,c){g.super_.call(this,"E",a),Object.defineProperty(this,"lhs",{value:b,enumerable:!0}),Object.defineProperty(this,"rhs",{value:c,enumerable:!0})}function h(a,b){h.super_.call(this,"N",a),Object.defineProperty(this,"rhs",{value:b,enumerable:!0})}function i(a,b){i.super_.call(this,"D",a),Object.defineProperty(this,"lhs",{value:b,enumerable:!0})}function j(a,b,c){j.super_.call(this,"A",a),Object.defineProperty(this,"index",{value:b,enumerable:!0}),Object.defineProperty(this,"item",{value:c,enumerable:!0})}function k(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=0>b?a.length+b:b,a.push.apply(a,d),a}function l(b,c,d,e,f,m){e=e||[];var n=e.slice(0);f&&n.push(f);var o=typeof b,p=typeof c;if("undefined"===o)"undefined"!==p&&d(new h(n,c));else if("undefined"===p)d(new i(n,b));else if(o!==p)d(new g(n,b,c));else if(b instanceof Date&&c instanceof Date&&b-c!=0)d(new g(n,b,c));else if("object"===o&&null!=b&&null!=c){if(m=m||[],m.indexOf(b)<0){if(m.push(b),Array.isArray(b)){var q,r=(b.length,function(a){d(new j(n,q,a))});for(q=0;q<b.length;q++)q>=c.length?d(new j(n,q,new i(a,b[q]))):l(b[q],c[q],r,[],null,m);for(;q<c.length;)d(new j(n,q,new h(a,c[q++])))}else{var s=Object.keys(b),t=Object.keys(c);s.forEach(function(e){var f=t.indexOf(e);f>=0?(l(b[e],c[e],d,n,e,m),t=k(t,f)):l(b[e],a,d,n,e,m)}),t.forEach(function(b){l(a,c[b],d,n,b,m)})}m.length=m.length-1}}else b!==c&&d(new g(n,b,c))}function m(b,c,d){return d=d||[],l(b,c,function(a){a&&d.push(a)}),d.length?d:a}function n(a,b,c){if(c.path&&c.path.length){var d,e=a[b],f=c.path.length-1;for(d=0;f>d;d++)e=e[c.path[d]];switch(c.kind){case"A":n(e,c.index,c.item);break;case"D":delete e[c.path[d]];break;case"E":case"N":e[c.path[d]]=c.rhs}}else switch(c.kind){case"A":n(a[b],c.index,c.item);break;case"D":a=k(a,b);break;case"E":case"N":a[b]=c.rhs}return a}function o(a,b,c){if(!(c instanceof f))throw new TypeError("[Object] change must be instanceof Diff");if(a&&b&&c){var d,e,g=a;for(e=c.path.length-1,d=0;e>d;d++)"undefined"==typeof g[c.path[d]]&&(g[c.path[d]]={}),g=g[c.path[d]];switch(c.kind){case"A":n(g[c.path[d]],c.index,c.item);break;case"D":delete g[c.path[d]];break;case"E":case"N":g[c.path[d]]=c.rhs}}}function p(a,b,c){if(a&&b){var d=function(d){(!c||c(a,b,d))&&o(a,b,d)};l(a,b,d)}}var q,r,s=[];q="object"==typeof d&&d?d:"undefined"!=typeof window?window:{},r=q.DeepDiff,r&&s.push(function(){"undefined"!=typeof r&&q.DeepDiff===m&&(q.DeepDiff=r,r=a)}),e(g,f),e(h,f),e(i,f),e(j,f),Object.defineProperties(m,{diff:{value:m,enumerable:!0},observableDiff:{value:l,enumerable:!0},applyDiff:{value:p,enumerable:!0},applyChange:{value:o,enumerable:!0},isConflict:{get:function(){return"undefined"!=typeof r},enumerable:!0},noConflict:{value:function(){return s&&(s.forEach(function(a){a()}),s=null),m},enumerable:!0}}),"undefined"!=typeof b&&b&&"object"==typeof c&&c&&b.exports===c?b.exports=m:q.DeepDiff=m}()},{}],3:[function(a,b){var c=a("deep-diff"),d=function(a,b,d,e){e=void 0===e?!1:e;var f=this,g=!1;f.lhs=!1,f.rhs=!1,f.changes=!1,f.parse=function(a){return g=b.defer(),f.parser.parseComplete(a),g.promise};var h=function(a,b){var c=this;if(void 0!==b.nodeName)return{resolve:function(){return b},debug:function(){return b.nodeName.toLowerCase()}};if(void 0===b.resolve)throw new Error("Node ref requires an static root node or an other Ref");c.parentRef=b,c.index=a,c.node=!1,c.fixate=function(){c.node=c.resolve()},c.resolve=function(){if(c.node!==!1)return c.node;var d=b.resolve();return void 0===d?void 0:d.childNodes[a]},c.debug=function(){return(b.debug()+"."+c.index).toLowerCase()}};f.Changeset=function(a){a=void 0===a?!1:a;var b=["emptyNode","removeNode","insertNode","replaceNode","removeAttribute","setAttribute","setData"],c=this,d=[];c.all=function(){return d},c.add=function(a){if(-1===b.indexOf(a.op))throw new Error("Unsupported operation: "+a.op);if(void 0===a.ref)throw new Error("Command must provide a reference to the subject.");if(void 0===a.depth)throw new Error("Command must provide a depth property.");if(void 0===a.order)throw new Error("Command must provide an order property.");d.push(a)},c.createReplacementNode=function(a,b,c){var d=!1;if(c===!1&&(c="ins"),b===!1&&(b="tag",1!==a.nodeType))throw new Error("Unexpected type switch");if(1===a.nodeType&&"tag"===b){var e=a.outerHTML;return e=e.replace(/<[^ >]*/i,"<"+c),e=e.replace(/<\/.*>$(?!.*<\/)/,"</"+c+">"),d=document.createElement("div"),d.innerHTML=e,d=d.childNodes[0]}if("tag"===b)return document.createElement(c);if("text"===b)return d=document.createTextNode(""),void 0!==a.data&&(d.data=a.data),d;if("comment"===b)return d=document.createComment(""),void 0!==a.data&&(d.data=a.data),d;throw new Error("Unexpected switch to:"+b)},c.applyOne=function(b){var d=!1;if(a&&console.log("cmd:",b.op,"ref:",void 0===b.ref.resolve().nodeName?b.ref.resolve():b.ref.resolve().nodeName),"removeNode"===b.op)b.ref.parentRef.resolve().removeChild(b.ref.resolve());else if("removeAttribute"===b.op)b.ref.resolve().removeAttribute(b.name);else if("setAttribute"===b.op)b.ref.resolve().setAttribute(b.name,b.value);else if("emptyNode"===b.op)for(;b.ref.resolve().firstChild;)b.ref.resolve().removeChild(b.ref.resolve().firstChild);else if("insertNode"===b.op){var e=c.createElement(b.node);b.ref.resolve().insertBefore(e,b.ref.resolve().childNodes[b.index])}else if("replaceNode"===b.op){var f=b.ref.resolve(),g=c.createReplacementNode(f,b.type,b.tag);b.ref.parentRef.resolve().replaceChild(g,f)}else if("setData"===b.op){var h=b.ref.resolve();h.data=b.rhs}return d},c.sortChanges=function(a){return a},c.apply=function(){var b=[];return a&&console.log("-----------------APPLY--------------------"),c.sortChanges(d).forEach(function(a){b.push(c.applyOne(a))}),b},c.createElement=function(a){if("tag"===a.type){var b=document.createElement(a.name);return a.attribs&&Object.keys(a.attribs).forEach(function(c){b.setAttribute(c,a.attribs[c])}),void 0!==a.children&&a.children.forEach(function(a){b.appendChild(c.createElement(a))}),b}if("text"===a.type)return document.createTextNode(a.data);throw new Error("Creating elements of type "+a.type+"is not supported")}};var i=function(a,b,c,d){if("N"===a.kind){if(!Array.isArray(a.rhs))throw new Error('Expected an array for new "children" received:'+JSON.stringify(a.rhs));e&&console.log(Array(d).join(" ")+"[CHILDREN][Append] (append all children) ",JSON.stringify(a.rhs)),a.rhs.forEach(function(a,b){f.changes.add({op:"insertNode",ref:c,depth:d,order:0,index:b,node:a})})}else if("D"===a.kind){if(!Array.isArray(a.lhs))throw new Error('Expected an array for old "children" received:'+JSON.stringify(a.lhs));e&&console.log(Array(d).join(" ")+"[CHILDREN][DELETE] (delete all children) ",JSON.stringify(a.lhs)),f.changes.add({op:"emptyNode",ref:c,depth:d,order:0})}else{if("A"!==a.kind)throw new Error('Invalid "children" change kind:'+a.kind);if(void 0===a.item||"object"!=typeof a.item||"N"!==a.item.kind)throw new Error('Expected an object for appending "children" received:'+JSON.stringify(a.item));e&&console.log(Array(d).join(" ")+"[CHILDREN][Append] (append to existing @"+a.index+")",JSON.stringify(a.item.rhs)),f.changes.add({op:"insertNode",ref:c,depth:d,order:0,index:a.index,node:a.item.rhs})}},j=function(a,b,c,d){var g=a.path[1];if(void 0!==g)if("N"===a.kind)e&&console.log(Array(d).join(" ")+"[ATTR][NEW] (set new attribute) ",g+": "+a.rhs),f.changes.add({op:"setAttribute",ref:c,depth:d,order:0,name:g,value:a.rhs});else if("E"===a.kind)e&&console.log(Array(d).join(" ")+"[ATTR][EDIT] (set existing attribute) ",g+": "+a.rhs),f.changes.add({op:"setAttribute",ref:c,depth:d,order:0,name:g,value:a.rhs});else{if("D"!==a.kind)throw new Error('Invalid "attribute" change kind:'+a.kind);e&&console.log(Array(d).join(" ")+"[ATTR][DELETE] (existing attribute) ",g),f.changes.add({op:"removeAttribute",ref:c,depth:d,order:0,name:g})}else if(void 0!==a.rhs&&"object"==typeof a.rhs&&"N"===a.kind)e&&console.log(Array(d).join(" ")+"[ATTR][NEW] (add all attributes) ",JSON.stringify(a.rhs)),Object.keys(a.rhs).forEach(function(b){f.changes.add({op:"setAttribute",ref:c,depth:d,order:0,name:b,value:a.rhs[b]})});else{if(void 0===a.lhs||"object"!=typeof a.lhs||"D"!==a.kind)throw new Error("Expected object has with new or old attributes, received:"+a);e&&console.log(Array(d).join(" ")+"[ATTR][DELETE] (remove all attributes) ",JSON.stringify(a.lhs)),Object.keys(a.lhs).forEach(function(a){f.changes.add({op:"removeAttribute",ref:c,depth:d,order:0,name:a})})}},k=function(a,b,c,d){if("E"===a.kind)e&&console.log(Array(d).join(" ")+"[TAG][EDIT] (replace) ",JSON.stringify(a)),f.changes.add({op:"replaceNode",ref:c,order:0,depth:d,type:!1,tag:a.rhs});else if("D"===a.kind)e&&console.log(Array(d).join(" ")+"[TAG][DELETE] (due to replace) ",JSON.stringify(a));else{if("N"!==a.kind)throw new Error('Invalid "type" change kind:'+a.kind);e&&console.log(Array(d).join(" ")+"[TAG][NEW] (due to replace) ",JSON.stringify(a)),f.changes.add({op:"replaceNode",ref:c,order:0,depth:d,type:!1,tag:a.rhs})}},l=function(a,b,c,d){if("E"===a.kind)e&&console.log(Array(d).join(" ")+"(edit content)"),f.changes.add({op:"setData",ref:c,order:0,depth:d,lhs:a.lhs,rhs:a.rhs});else if("D"===a.kind)e&&console.log(Array(d).join(" ")+"[DATA][DELETE] (due to replace) ",JSON.stringify(a));else{if("N"!==a.kind)throw new Error('Invalid "data" change kind:'+a.kind);e&&console.log(Array(d).join(" ")+"[DATA][NEW] (due to replace) ",JSON.stringify(a)),f.changes.add({op:"setData",ref:c,order:0,depth:d,lhs:a.lhs,rhs:a.rhs})}},m=function(a,b,c,d){d=void 0===d?1:d;var g=void 0===a.path?"self":a.path[0];if(e===!0&&console.log(Array(d).join(" ")+"["+a.kind+"] "+c.debug()),void 0!==b.children&&void 0!==b.children[a.index]&&"A"===a.kind&&"children"===g)m(a.item,b.children[a.index],new h(a.index,c),d+1);else if("children"===g)i(a,b,c,d);else if("attribs"===g)j(a,b,c,d);else if("name"===g)k(a,b,c,d);else if("data"===g)l(a,b,c,d);else if("type"===g){if("E"!==a.kind)throw new Error('Invalid "type" change kind:'+a.kind);e&&console.log(Array(d).join(" ")+"[TYPE][E] (replace) ",JSON.stringify(a)),f.changes.add({op:"replaceNode",ref:c,order:0,depth:d,type:a.rhs,tag:!1})}else{if("self"!==g)throw new Error('Path "'+g+'" is not implemented.');if("D"!==a.kind)throw new Error("Only possible to delete yourself.");e&&console.log(Array(d).join(" ")+"(delete itself) ",JSON.stringify(a)),c.fixate(),f.changes.add({op:"removeNode",ref:c,order:0,depth:d})}};f.compare=function(){var a=c.diff(f.lhs,f.rhs);if(!Array.isArray(a))return!1;f.changes=new f.Changeset(e),e===!0&&console.log("-----------------Walk--------------------");var b=new h(0,d);return a.forEach(function(a){m(a.item,f.lhs[a.index],new h(a.index,b),1)}),f.changes},f.handle=function(a,b){if(a)throw new Error(a);f.rhs===!1?(f.rhs=b,f.parser.parseComplete(d.innerHTML)):f.lhs===!1?(f.lhs=b,g.resolve(f.rhs)):(f.lhs=f.rhs,f.rhs=b,g.resolve(f.rhs))},f.handler=new a.DefaultHandler(f.handle,{verbose:!1,ignoreWhitespace:!0}),f.parser=new a.Parser(f.handler)};b.exports=d},{"deep-diff":2}]},{},[1]);