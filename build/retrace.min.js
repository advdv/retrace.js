!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){var b=a("./src/retrace.js");window.Retrace=b},{"./src/retrace.js":4}],2:[function(a,b){var c=a("./ref.js"),d=function(a){a=void 0===a?!1:a;var b=["emptyNode","removeNode","insertNode","replaceNode","removeAttribute","setAttribute","setData"],d=this,e=[];d.all=function(){return e},d.add=function(a){if(-1===b.indexOf(a.op))throw new Error("Unsupported operation: "+a.op);if(void 0===a.ref)throw new Error("Command must provide a reference to the subject.");if(void 0===a.depth)throw new Error("Command must provide a depth property.");if(void 0===a.order)throw new Error("Command must provide an order property.");e.push(a)},d.createReplacementNode=function(a,b,c){var d=!1;if(c===!1&&(c="ins"),b===!1&&(b="tag",1!==a.nodeType))throw new Error("Unexpected type switch");if(1===a.nodeType&&"tag"===b){var e=a.outerHTML;return e=e.replace(/<[^ >]*/i,"<"+c),e=e.replace(/<\/.*>$(?!.*<\/)/,"</"+c+">"),d=document.createElement("div"),d.innerHTML=e,d=d.childNodes[0]}if("tag"===b)return document.createElement(c);if("text"===b)return d=document.createTextNode(""),void 0!==a.data&&(d.data=a.data),d;if("comment"===b)return d=document.createComment(""),void 0!==a.data&&(d.data=a.data),d;throw new Error("Unexpected switch to:"+b)},d.applyOne=function(b){var e=!1;if(a&&console.log("cmd:",b.op,"ref:",void 0===b.ref.resolve().nodeName?b.ref.resolve():b.ref.resolve().nodeName),"removeNode"===b.op)b.ref.parentRef.resolve().removeChild(b.ref.resolve());else if("removeAttribute"===b.op)b.ref.resolve().removeAttribute(b.name);else if("setAttribute"===b.op)b.ref.resolve().setAttribute(b.name,b.value);else if("emptyNode"===b.op)for(;b.ref.resolve().firstChild;)b.ref.resolve().removeChild(b.ref.resolve().firstChild);else if("insertNode"===b.op){var f=d.createElement(b.node),g=new c(b.index,b.ref);b.ref.resolve().insertBefore(f,g.resolve())}else if("replaceNode"===b.op){var h=b.ref.resolve(),i=d.createReplacementNode(h,b.type,b.tag);b.ref.parentRef.resolve().replaceChild(i,h)}else if("setData"===b.op){var j=b.ref.resolve();j.data=b.rhs}return e},d.sortChanges=function(a){return a},d.apply=function(){var a=[];return d.sortChanges(e).forEach(function(b){a.push(d.applyOne(b))}),a},d.createElement=function(a){if("tag"===a.type){var b=document.createElement(a.name);return a.attribs&&Object.keys(a.attribs).forEach(function(c){b.setAttribute(c,a.attribs[c])}),void 0!==a.children&&a.children.forEach(function(a){b.appendChild(d.createElement(a))}),b}if("text"===a.type)return document.createTextNode(a.data);if("comment"===a.type)return document.createComment(a.data);throw new Error("Creating elements of type "+a.type+"is not supported")}};b.exports=d},{"./ref.js":3}],3:[function(a,b){var c=function(a,b){var c=this,d=!1;if(void 0!==b.nodeName)return{resolve:function(){return b},debug:function(){return b.nodeName.toLowerCase()}};if(void 0===b.resolve)throw new Error("Node ref requires an static root node or an other Ref");c.parentRef=b,c.index=a,c.fixate=function(){d=c.resolve()},c.resolve=function(){if(d!==!1)return d;var c,e,f=b.resolve(),g=0;for(c=0;c<f.childNodes.length;c+=1){var h=f.childNodes[c];g===a&&(e=h),(3!==h.nodeType||0!==h.data.replace(/\s+/g,"").length)&&(g+=1)}return e},c.debug=function(){return(b.debug()+"."+c.index).toLowerCase()}};b.exports=c},{}],4:[function(a,b){var c=a("./changeset.js"),d=a("./ref.js"),e=function(a,b,e,f,g){g=void 0===g?!1:g;var h=this,i=!1;h.lhs=!1,h.rhs=!1,h.changes=!1,h.parse=function(a,c){if(void 0!==c&&"function"==typeof c)a=c(a);else{var d=a.match(/<body[^ >]*>/im);null!==d&&(a=a.substring(a.indexOf(d[0])+d[0].length,a.lastIndexOf("</body")))}return i=b.defer(),h.parser.parseComplete(a),i.promise},h.compare=function(){var a=e.diff(h.lhs,h.rhs);if(!Array.isArray(a))return!1;h.changes=new c(g);var b=new d(0,f);return a.forEach(function(a){n(a.item,h.lhs[a.index],new d(a.index,b),1)}),h.changes},h.handle=function(a,b){if(a)throw new Error(a);h.rhs===!1?(h.rhs=b,h.parser.parseComplete(f.innerHTML)):h.lhs===!1?(h.lhs=b,i.resolve(h.rhs)):(h.lhs=h.rhs,h.rhs=b,i.resolve(h.rhs))},h.handler=new a.DefaultHandler(h.handle,{verbose:!1,ignoreWhitespace:!0}),h.parser=new a.Parser(h.handler);var j=function(a,b,c,d){if("N"===a.kind){if(!Array.isArray(a.rhs))throw new Error('Expected an array for new "children" received:'+JSON.stringify(a.rhs));g&&console.log(Array(d).join(" ")+"[CHILDREN][Append] (append all children) ",JSON.stringify(a.rhs)),a.rhs.forEach(function(a,b){h.changes.add({op:"insertNode",ref:c,depth:d,order:0,index:b,node:a})})}else if("D"===a.kind){if(!Array.isArray(a.lhs))throw new Error('Expected an array for old "children" received:'+JSON.stringify(a.lhs));g&&console.log(Array(d).join(" ")+"[CHILDREN][DELETE] (delete all children) ",JSON.stringify(a.lhs)),h.changes.add({op:"emptyNode",ref:c,depth:d,order:0})}else{if("A"!==a.kind)throw new Error('Invalid "children" change kind:'+a.kind);if(void 0===a.item||"object"!=typeof a.item||"N"!==a.item.kind)throw new Error('Expected an object for appending "children" received:'+JSON.stringify(a.item));g&&console.log(Array(d).join(" ")+"[CHILDREN][Append] (append to existing @"+a.index+")",JSON.stringify(a.item.rhs)),h.changes.add({op:"insertNode",ref:c,depth:d,order:0,index:a.index,node:a.item.rhs})}},k=function(a,b,c,d){var e=a.path[1];if(void 0!==e)if("N"===a.kind)g&&console.log(Array(d).join(" ")+"[ATTR][NEW] (set new attribute) ",e+": "+a.rhs),h.changes.add({op:"setAttribute",ref:c,depth:d,order:0,name:e,value:a.rhs});else if("E"===a.kind)g&&console.log(Array(d).join(" ")+"[ATTR][EDIT] (set existing attribute) ",e+": "+a.rhs),h.changes.add({op:"setAttribute",ref:c,depth:d,order:0,name:e,value:a.rhs});else{if("D"!==a.kind)throw new Error('Invalid "attribute" change kind:'+a.kind);g&&console.log(Array(d).join(" ")+"[ATTR][DELETE] (existing attribute) ",e),h.changes.add({op:"removeAttribute",ref:c,depth:d,order:0,name:e})}else if(void 0!==a.rhs&&"object"==typeof a.rhs&&"N"===a.kind)g&&console.log(Array(d).join(" ")+"[ATTR][NEW] (add all attributes) ",JSON.stringify(a.rhs)),Object.keys(a.rhs).forEach(function(b){h.changes.add({op:"setAttribute",ref:c,depth:d,order:0,name:b,value:a.rhs[b]})});else{if(void 0===a.lhs||"object"!=typeof a.lhs||"D"!==a.kind)throw new Error("Expected object has with new or old attributes, received:"+a);g&&console.log(Array(d).join(" ")+"[ATTR][DELETE] (remove all attributes) ",JSON.stringify(a.lhs)),Object.keys(a.lhs).forEach(function(a){h.changes.add({op:"removeAttribute",ref:c,depth:d,order:0,name:a})})}},l=function(a,b,c,d){if("E"===a.kind)g&&console.log(Array(d).join(" ")+"[TAG][EDIT] (replace) ",JSON.stringify(a)),h.changes.add({op:"replaceNode",ref:c,order:0,depth:d,type:!1,tag:a.rhs});else if("D"===a.kind)g&&console.log(Array(d).join(" ")+"[TAG][DELETE] (due to replace) ",JSON.stringify(a));else{if("N"!==a.kind)throw new Error('Invalid "type" change kind:'+a.kind);g&&console.log(Array(d).join(" ")+"[TAG][NEW] (due to replace) ",JSON.stringify(a)),h.changes.add({op:"replaceNode",ref:c,order:0,depth:d,type:!1,tag:a.rhs})}},m=function(a,b,c,d){if("E"===a.kind)g&&console.log(Array(d).join(" ")+"(edit content)"),h.changes.add({op:"setData",ref:c,order:0,depth:d,lhs:a.lhs,rhs:a.rhs});else if("D"===a.kind)g&&console.log(Array(d).join(" ")+"[DATA][DELETE] (due to replace) ",JSON.stringify(a));else{if("N"!==a.kind)throw new Error('Invalid "data" change kind:'+a.kind);g&&console.log(Array(d).join(" ")+"[DATA][NEW] (due to replace) ",JSON.stringify(a)),h.changes.add({op:"setData",ref:c,order:0,depth:d,lhs:a.lhs,rhs:a.rhs})}},n=function(a,b,c,e){var f=void 0===a.path?"self":a.path[0];if(g===!0&&console.log(Array(e).join(" ")+"["+a.kind+"] "+c.debug()),void 0!==b.children&&void 0!==b.children[a.index]&&"A"===a.kind&&"children"===f)n(a.item,b.children[a.index],new d(a.index,c),e+1);else if("children"===f)j(a,b,c,e);else if("attribs"===f)k(a,b,c,e);else if("name"===f)l(a,b,c,e);else if("data"===f)m(a,b,c,e);else if("type"===f){if("E"!==a.kind)throw new Error('Invalid "type" change kind:'+a.kind);g&&console.log(Array(e).join(" ")+"[TYPE][E] (replace) ",JSON.stringify(a)),h.changes.add({op:"replaceNode",ref:c,order:0,depth:e,type:a.rhs,tag:!1})}else{if("self"!==f)throw new Error('Path "'+f+'" is not implemented.');if("D"!==a.kind)throw new Error("Only possible to delete yourself.");g&&console.log(Array(e).join(" ")+"(delete itself) ",JSON.stringify(a)),c.fixate(),h.changes.add({op:"removeNode",ref:c,order:0,depth:e})}}};b.exports=e},{"./changeset.js":2,"./ref.js":3}]},{},[1]);